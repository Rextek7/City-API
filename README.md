
# City API
## Описание

Этот проект представляет собой API для добавления/удаления/чтения и поиска ближайших гороодов на основании их названий и координат 
## Стек технологий
* ### Язык: Python
* ###   Веб-фреймворк: FastAPI
* ###  СУБД: PostgreSQL
* ###   ORM: SQLAlchemy
* ###   Миграции БД: Alembic
* ###   Окружение: Docker

## Архитектура
### Проект структурирован следующим образом:


```
project/
├── app/
│   ├── requirements.txt
│   ├── main.py
│   ├── model.py
│   ├── schemas.py
│   ├── logic.py
│   ├── data_parcing.py
│   └── database.py
├── docker/
│   ├── Dockerfile
│   └── docker-compose.yml
└── extr/
    └── .env
```
## Подходы и примененные паттерны
* ###  Dependency Injection: Используется для внедрения зависимостей, таких как база данных, в маршруты FastAPI.
* ###   Data Transfer Objects (DTOs): Использование Pydantic моделей для валидации данных на входе и выходе.
* ###   Alembic for Migrations: Управление миграциями базы данных с помощью Alembic.

## Модели базы данных

### cities:
* #### id: Integer (PK)
* #### name: String (unique)
* #### latitude: Float
* #### longitude: Float

### requests:
* #### id: Integer (PK)
* #### request_type: RequestType
* #### city_id: Integer
* #### name: String
* #### latitude: Float
* #### longitude: Float
* #### request_time: DateTime


## Нормализация базы данных
### База данных спроектирована в третьей нормальной форме (3NF):
* #### Первая нормальная форма (1NF): Все столбцы содержат атомарные значения, таблицы не содержат повторяющихся групп.
* #### Вторая нормальная форма (2NF): Все неключевые столбцы зависят от первичного ключа.
* #### Третья нормальная форма (3NF): Все неключевые столбцы не зависят транзитивно от первичного ключа.


## Запуск
### Для поднятия окружения использовался Docker

### Создание образа:
```
docker build -t citiesapi:latest .
```
### Сборка и запуск контейнеров
```
docker-compose up -d
```
### Использование
#### Порт отличается он выдаваемого докером ввиду рализчия локальных хостов на Windows и Linux
```
http://localhost:8080/docs
```

### Примеры запросов
#### Добавление города

```
POST /addition/
{
  "name": "string"
}
```

#### Удаление города

```
DELETE /cities/{city_name}/delete
{
  "city_name": string,
}
```

#### Поиск ближайших городов
Реализован поиск по названию и координатам, независимо от их наличия в бд

```
GET /nearest_cities/
{
  "city_name": string,
  "latitude": float,
  "longitude": float
}
```
### Упрощения
* #### Таблица requests: логирование действий пользователя
* #### Docker: удобное и быстрое поднятие окружения
* #### requirements: зависимости для установки
* #### R tree: алгоритм пространственного графа, для ускорения поиска ближайших городов
* #### docker-compose и .env: данные файлы в реальной разработке на github не постятся, однако для удобства оставлены
